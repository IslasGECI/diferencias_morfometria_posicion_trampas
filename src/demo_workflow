#!/usr/bin/env bash
#
# 1. Recibimos los datos
# 2. Encontrar duplicados
   ./src/distinct_position_traps tests/data/IG_POSICION_TRAMPAS_10MAY2020.xlsx
# 3. Revisar nombres de las columnas
   src/make_check_header.R --data tests/data/IG_POSICION_TRAMPAS_10MAY2020.csv
# 4. Validacion con datapackage
  #Cambiamos el encabezado y movemos el archivo a la carpeta que contiene el datapackage.json para
  #correr ahí el goodtables
./src/change_header tests/data/IG_POSICION_TRAMPAS_10MAY2020.csv


# 5. Hacerlos tidy (feature/agrega_script_con_cli)
src/make_table_tidy.R --data tests/data/IG_POSICION_TRAMPAS_10MAY2020.csv \
    --salida IG_POSICION_TRAMPAS_10MAY2020_tidy.csv
# 6. Limpiar archivos
# 6.1 Morfometría
# Tiene que ser la salida de la funcion cambia formato_fecha (ISO8601)
	src/clean_morphometry.R \
    --data=data/raw/morfometria_gatos_erradicacion_isla_guadalupe_ISO8601.csv \
    --out=reports/tables/cleaned_morphometry_cats.csv
# 6.2 Posición trampa
	src/get_captures.R \
		--data=IG_POSICION_TRAMPAS_10MAY2020_tidy.csv \
		--out=reports/tables/cleaned_position_traps.csv
# 7. Comparar morfometría con posicion (Capturas que no están en morfometría)
# 	>$@ Salida estándar
    src/show_diff_morphometry_position.R \
		--data_1=reports/tables/cleaned_position_traps.csv \
		--data_2=reports/tables/cleaned_morphometry_cats.csv \
		> missing_captures_in_position.csv
# 8. Comparar posicion con morfometría (Capturas que no están en posición)
    src/show_diff_morphometry_position.R \
		--data_1=reports/tables/cleaned_morphometry_cats.csv \
        --data_2=reports/tables/cleaned_position_traps.csv \
		> missing_captures_in_morfometry.csv
# 9. Consignamos (pre-commit)
	# El precommit verifica que los archivos missing_captures_in_position.csv y 
	# missing_captures_in_morfometry estén vacios para poder consignar IG_POSICION_TRAMPAS_10MAY2020.csv

# 10. Query para separar por zonas

# 11. Sacamos resumen

# 12. Agregar resumen semanal a base de datos mayor